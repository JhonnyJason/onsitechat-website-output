<!doctype html><html lang="en"><head><meta charset="utf-8"><title>On Site Chat</title><meta name="description" content="This is the project Website for the On Site Chat(OSC) - the (video) chat on your websites you are fully in charge of."><meta property="og:image" content="https://onsitechat.org/img/hero-image1.png"><meta property="og:title" content="On Site Chat"><meta property="og:description" content="This is the project Website for the On Site Chat(OSC) - the (video) chat on your websites you are fully in charge of."><meta property="og:type" content="website"><meta property="og:url" content="https://onsitechat.org"><meta property="og:locale" content="en_US"><link rel="manifest" href="manifest.json"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><meta name="viewport" content="width=device-width,initial-scale=1"><style>a,abbr,acronym,address,article,aside,b,big,blockquote,body,caption,cite,code,dd,del,dfn,div,dl,dt,em,fieldset,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,nav,object,ol,p,pre,q,samp,section,small,span,strike,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,tt,ul,var{margin:0;padding:0;border:0;outline:0;font-size:100%;font:inherit;vertical-align:baseline}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}a{transition:.2s ease-in-out;color:inherit;text-decoration:none}a:hover{text-decoration:none;opacity:.6}ul{margin:0}b,strong{font-weight:700}i{font-style:italic}button,button:hover,input:focus,input[type=checkcbox]:focus,input[type=submit]:hover,select:focus,textarea:focus{background:0 0;border:0;padding:0;outline:0;line-height:normal;overflow:visible}@font-face{font-family:Inter;font-style:normal;font-weight:500;src:url(font/Inter-Medium.woff2?v=3.19) format("woff2")}@font-face{font-family:Inter;font-style:normal;font-weight:700;src:url(font/Inter-Bold.woff2?v=3.19) format("woff2")}html{width:100%;height:100%}body{line-height:1;background-color:#fff;color:#000;font-family:Inter,Arial,Helvetica,sans-serif;font-weight:500;text-align:left;font-size:12pt;min-height:100%;width:100%;box-sizing:border-box;overflow-y:auto;overflow-x:hidden}h1{font-family:Inter;font-weight:700;font-size:32px}h2{font-family:Inter;font-weight:700;font-size:24px}p{font-size:12pt}.click-button{cursor:pointer;position:relative;display:inline-block;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.click-button::after{content:"";width:100%;height:100%;position:absolute;top:0;left:0;border-radius:12px;display:inline-block;transform:scaleX(1.2) scaleY(1.2);opacity:0;transition:opacity .3s,transform .3s;background:#fff}.click-button:active::after{transform:scaleX(0) scaleY(0);opacity:.8;transition:opacity,transform}.click-button:disabled{color:#888;background-color:#eee;filter:grayscale(100%)}#hidden-templates,.click-button:disabled::after{display:none}#chatframe.here{transform:translateX(0)}#chatframe{position:fixed;z-index:50;top:0;left:0;width:100%;height:100%;box-sizing:border-box;transform:translateX(-102%);background:#333;transition:transform .3s}#close-button{position:absolute;top:10px;right:10px;border-radius:10px;padding:5px}#close-button svg{height:25px;width:25px}#close-button:hover{background-color:rgba(222,222,222,.467)}#hangup-button{display:none;cursor:pointer;position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background-color:rgba(222,222,222,.467);padding:11px 18px;border-radius:20px;height:83px;width:97px;box-sizing:border-box}#hangup-button svg{pointer-events:none;height:60px;width:60px;color:red;border-radius:50%;border:1px solid #fff;background-color:#bababa}#hangup-button.here{display:block}#my-video-streams-block{display:flex;position:absolute;top:15px;right:15px;width:330px;height:110px}#desktop-capture-block{width:165px;height:110px;background-color:transparent}#web-cam-block{object-fit:cover;width:165px;height:110px;border-radius:20px;background-color:rgba(222,222,222,.467);border:1px solid #fff}#incoming-video-streams-block{object-fit:cover;width:100%;height:100%;overflow:hidden}#peer-display-block{position:absolute;bottom:30px;right:45px}#peer-display-block .peer-display-element{margin-bottom:10px;padding:5px 10px;width:380px;color:#fff;background-color:rgba(222,222,222,.467);border-radius:10px;border:1px solid #fff;display:flex;justify-content:space-around;align-items:center}#peer-display-block .peer-display-element svg{width:30px;height:30px}#peer-display-block .peer-display-element .peer-name-display{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#peer-display-block .peer-display-element .peer-call-button{display:none;padding:5px}#peer-display-block .peer-display-element .peer-video-button{padding:5px}#peer-display-block .peer-display-element .click-button[disabled]{pointer-events:none;color:grey;opacity:.5}#peer-display-block .peer-display-element.self{background-color:rgba(68,136,68,.6)}#text-chat-block{background-color:rgba(222,222,222,.467);position:absolute;bottom:30px;left:45px;width:280px;box-sizing:border-box;max-height:calc(100% - 60px);border-radius:20px;padding:15px;border:1px solid #fff}#chat-input-block{display:block;width:100%;background-color:rgba(222,222,222,.467);border-radius:10px;border:1px solid #fff;box-sizing:border-box}#chat-input-block input{padding:10px;box-sizing:border-box;background-color:transparent;text-align:left;width:100%;border:none;font-size:13pt;color:#fff}#chat-input-block input:focus{background-color:rgba(68,68,68,.6);border-radius:10px;border:none}#chat-history-block{display:block;display:flex;flex-direction:column-reverse;width:250px;max-height:calc(100vh - 140px);overflow:hidden}#chat-history-block .chat-element{margin-bottom:10px;padding:10px;font-size:12pt;letter-spacing:.8pt;line-height:120%;border-radius:30px 30px 30px 0;background-color:rgba(222,222,222,.467);width:235px;box-sizing:border-box}#chat-history-block .chat-element.mine{margin-bottom:10px;padding:10px;font-size:12pt;letter-spacing:.8pt;line-height:120%;border-radius:30px 30px 0;background-color:rgba(222,222,222,.467);width:235px;box-sizing:border-box}#chat-history-block .chat-text{overflow:hidden;text-overflow:ellipsis;text-align:left;color:purple}#chat-history-block .chat-time{display:none;text-align:right;padding:3px;font-size:7pt;color:#a9a9a9}@media screen and (min-width:600px){#my-video-streams-block{right:45px;top:35px;width:600px;height:200px}#desktop-capture-block,#web-cam-block{width:300px;height:200px}}#footer{width:100%}#footer #footer-line{padding-top:30px;padding-bottom:30px;text-align:center;font-size:24px}#header{width:100%;padding:50px 4%;box-sizing:border-box}#header #header-top-line{display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid #000;padding-top:10px;padding-bottom:30px}#header #header-menu-button{cursor:pointer;padding:10px;border-radius:50%}#header #header-menu-button svg{height:25px;width:25px}#header #header-menu-button:hover{background-color:#efefef}#header h2{padding-top:10px}#onsitechat{width:100%;min-height:20px;background-color:rgba(0,0,0,.2)}#svgicon-symbols{display:none}#svgicon-definitions{position:absolute;height:0;width:0;bottom:0;right:0}#hero-image{height:60vw;max-height:853px;width:100%;max-width:1280px;background-image:url(img/hero-image1.png);background-size:contain;background-repeat:no-repeat;background-position:center;margin-left:auto;margin-right:auto}#chat-button{background-color:rgba(222,222,222,.667);border-radius:10px;position:fixed;bottom:10px;right:10px;transform:scale(-1,1);padding:5px}#chat-button svg{width:40px;height:40px}</style></head><body><svg id="svgicon-definitions"><defs><filter id="svg-dropshadow-filter" height="130%" width="130%"><fegaussianblur in="SourceGraphic" stddeviation="3" result="blurOut"></fegaussianblur><feColorMatrix in="blurOut" type="saturate" values="0.25" result="shadowOut"></feColorMatrix><feblend in="SourceGraphic" in2="shadowOut" mode="normal"></feblend></filter></defs></svg> <svg id="svgicon-symbols"><symbol id="svg-cross-icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></symbol><symbol id="svg-menu-icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 23 23"><path d="M11.5 4.67188C12.0954 4.67188 12.5781 4.18918 12.5781 3.59375C12.5781 2.99832 12.0954 2.51562 11.5 2.51562C10.9046 2.51562 10.4219 2.99832 10.4219 3.59375C10.4219 4.18918 10.9046 4.67188 11.5 4.67188Z" stroke="currentColor" stroke-width="2.15625" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11.5 12.5781C12.0954 12.5781 12.5781 12.0954 12.5781 11.5C12.5781 10.9046 12.0954 10.4219 11.5 10.4219C10.9046 10.4219 10.4219 10.9046 10.4219 11.5C10.4219 12.0954 10.9046 12.5781 11.5 12.5781Z" stroke="currentColor" stroke-width="2.15625" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11.5 20.4844C12.0954 20.4844 12.5781 20.0017 12.5781 19.4062C12.5781 18.8108 12.0954 18.3281 11.5 18.3281C10.9046 18.3281 10.4219 18.8108 10.4219 19.4062C10.4219 20.0017 10.9046 20.4844 11.5 20.4844Z" stroke="currentColor" stroke-width="2.15625" stroke-linecap="round" stroke-linejoin="round"></path></symbol><symbol id="svg-query-icon" preserveAspectRatio="xMidYMid meet" viewbox="0 0 24 24"><path fill="currentColor" d="M3 21V17H10.5C12.43 17 14 15.43 14 13.5V11H10L16 4L22 11H18V13.5C18 17.64 14.64 21 10.5 21H3Z"></path></symbol><symbol id="svg-phone-icon" preserveAspectRatio="xMidYMid meet" viewbox="0 0 24 24"><path fill="currentColor" d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"></path></symbol><symbol id="svg-cam-icon" preserveAspectRatio="xMidYMid meet" viewbox="0 0 30 31"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 9.92432C0 8.92975 0.395088 7.97593 1.09835 7.27267C1.80161 6.5694 2.75544 6.17432 3.75 6.17432H17.8125C18.722 6.17421 19.6006 6.50468 20.2846 7.10418C20.9687 7.70368 21.4115 8.53136 21.5306 9.43307L27.3619 6.84182C27.6473 6.71464 27.96 6.66081 28.2715 6.68523C28.583 6.70964 28.8835 6.81153 29.1456 6.98162C29.4078 7.15171 29.6232 7.38462 29.7724 7.65917C29.9216 7.93372 29.9999 8.24121 30 8.55369V22.5449C29.9997 22.8572 29.9215 23.1644 29.7724 23.4387C29.6233 23.7131 29.408 23.9458 29.1461 24.1158C28.8843 24.2859 28.5841 24.3878 28.2728 24.4125C27.9616 24.4371 27.6491 24.3836 27.3638 24.2568L21.5306 21.6656C21.4115 22.5673 20.9687 23.3949 20.2846 23.9945C19.6006 24.594 18.722 24.9244 17.8125 24.9243H3.75C2.75544 24.9243 1.80161 24.5292 1.09835 23.826C0.395088 23.1227 0 22.1689 0 21.1743V9.92432Z" fill="currentColor"></path></symbol><symbol id="svg-chat-icon" preserveAspectRatio="xMidYMid meet" viewbox="0 0 24 24"><path fill="currentColor" d="M12,3C17.5,3 22,6.58 22,11C22,15.42 17.5,19 12,19C10.76,19 9.57,18.82 8.47,18.5C5.55,21 2,21 2,21C4.33,18.67 4.7,17.1 4.75,16.5C3.05,15.07 2,13.13 2,11C2,6.58 6.5,3 12,3Z"></path></symbol><symbol id="svg-hangup-icon" preserveAspectRatio="xMidYMid meet" viewbox="0 0 24 24"><path fill="currentColor" d="M12,9C10.4,9 8.85,9.25 7.4,9.72V12.82C7.4,13.22 7.17,13.56 6.84,13.72C5.86,14.21 4.97,14.84 4.17,15.57C4,15.75 3.75,15.86 3.5,15.86C3.2,15.86 2.95,15.74 2.77,15.56L0.29,13.08C0.11,12.9 0,12.65 0,12.38C0,12.1 0.11,11.85 0.29,11.67C3.34,8.77 7.46,7 12,7C16.54,7 20.66,8.77 23.71,11.67C23.89,11.85 24,12.1 24,12.38C24,12.65 23.89,12.9 23.71,13.08L21.23,15.56C21.05,15.74 20.8,15.86 20.5,15.86C20.25,15.86 20,15.75 19.82,15.57C19.03,14.84 18.14,14.21 17.16,13.72C16.83,13.56 16.6,13.22 16.6,12.82V9.72C15.15,9.25 13.6,9 12,9Z"></path></symbol></svg><div id="hidden-templates"><div id="peer-display-template"><li class="peer-display-element" uuid="{{{uuid}}}"><div class="peer-name-display">{{{uuid}}}</div><div class="peer-call-button click-button" disabled="disabled"><svg><use href="#svg-phone-icon"></use></svg></div><div class="peer-video-button click-button"><svg><use href="#svg-cam-icon"></use></svg></div></li></div><div id="chat-element-template"><li class="chat-element"><div class="chat-text">{{{text}}}</div><div class="chat-time">{{{time}}}</div></li></div></div><div id="chatframe"><video id="incoming-video-streams-block" autoplay></video><a class="click-button" id="close-button" href="#"><svg><use href="#svg-cross-icon"></use></svg></a><div class="click-button" id="hangup-button"><svg><use href="#svg-hangup-icon"></use></svg></div><div id="my-video-streams-block"><video id="desktop-capture-block" muted autoplay></video><video id="web-cam-block" muted autoplay></video></div><ul id="peer-display-block"></ul><div id="text-chat-block"><ul id="chat-history-block"></ul><div id="chat-input-block"><input id="chat-input"></div></div></div><div id="header"><div id="header-top-line"><h1 id="header-title">osc: on site chat</h1><div class="click-button" id="header-menu-button"><svg><use href="#svg-menu-icon"></use></svg></div></div><div id="header-sub-titles"><h2>free and open source online communication</h2><h2>proof of concept</h2></div></div><div id="hero-image"></div><a class="click-button" id="chat-button" href="#chat"><svg><use href="#svg-chat-icon"></use></svg></a><div id="footer"><div id="footer-line"><a href="mailto:office@onsitechat.org">office@onsitechat.org</a></div></div><script>(()=>{var n={353:(e,t,n)=>{"use strict";n.r(t),n.d(t,{nickName:()=>o});var o="JhonnyJason"},62:function(t,e,n){!function(){var e={name:"indexdomconnect",initialize:function(){n.g.peerDisplayTemplate=document.getElementById("peer-display-template"),n.g.chatElementTemplate=document.getElementById("chat-element-template"),n.g.chatframe=document.getElementById("chatframe"),n.g.incomingVideoStreamsBlock=document.getElementById("incoming-video-streams-block"),n.g.hangupButton=document.getElementById("hangup-button"),n.g.desktopCaptureBlock=document.getElementById("desktop-capture-block"),n.g.webCamBlock=document.getElementById("web-cam-block"),n.g.peerDisplayBlock=document.getElementById("peer-display-block"),n.g.chatHistoryBlock=document.getElementById("chat-history-block"),n.g.chatInput=document.getElementById("chat-input")}};t.exports=e}.call(this)},981:function(b,e,k){!function(){var r,n,o,c,l,i,a,s,u,d,t,f,e,p,h,g,v={name:"statemodule"},m=function(e){null!=allModules.debugmodule.modulesToDebug.statemodule&&console.log("[statemodule]: "+e)},y=function(e){return JSON.stringify(e,null,4)},w=function(e){return m("\n"+y(e))};try{s=k(353)}catch(e){}g=null,r={},d={},i={},f=function(){var e,t;for(t in g=null!=(g=localStorage.getItem("state"))?JSON.parse(g):{})null==(e=g[t])&&(e=null),null!=e&&null!=e.content||(g[t]={content:e}),r[t]=g[t];for(t in s)e=s[t],null==r[t]&&(r[t]={content:e,isVolatile:!0})},u=function(e,t){return e!==t},l=function(e,t){var n=i[e]||u;return null==r[e]||(r[e].content,n(r[e].content,t))},t=function(e){var t;return m("loadDedicated"),t=localStorage.getItem(e),t=JSON.parse(t),r[e]={content:t,isDedicated:!0},t},p=function(e){var t;m("saveDedicatedState"),m(e),w({allStates:r}),t=r[e].content,r[e].isDedicated=!0,t=JSON.stringify(t),localStorage.setItem(e,t)},h=function(){var e;m("saveRegularState"),e=JSON.stringify(g),localStorage.setItem("state",e)},o=function(e,t,n,o){var i,a=null!=r[e]&&r[e].isVolatile;if("boolean"!=typeof n&&(n=null!=r[e]&&!0===r[e].isDedicated),null!=r[e]){if(i=r[e].isDedicated?n!==r[e].isDedicated:n,!(l(e,t)||a||i))return;r[e].content=t,n&&(r[e].isDedicated=!0),i&&!n&&(localStorage.removeItem(e),delete r[e].isDedicated),a&&delete r[e].isVolatile}else r[e]={content:t,isDedicated:n};if(n?(p(e),null!=g[e]&&(delete g[e],h())):(null==g[e]&&(g[e]=r[e]),h()),!o)return c(e)},e=function(){for(var e in m("saveAllStates"),w(r),r)r[e].isDedicated&&p(e);h()},n=function(e,t,n){if(l(e,t)){try{r[e].content=t}catch(n){r[e]={content:t,isVolatile:!0}}if(!n)return c(e)}},a=function(e){var t;if(1!==(t=Object.keys(e)).length)throw new Error("Object did not have exactly one Member!");return{key:t=t[0],content:e[t]}},c=async function(i){var a,e;if(null!=d[i])return e=function(){for(var e,t=[],n=0,o=(e=d[i]).length;n<o;n++)a=e[n],t.push(a());return t}(),Promise.all(e)},v.getState=function(){return r},v.load=function(e){return m("statemodule.load"),w({allStates:r}),null!=r[e]&&r[e].isVolatile?r[e].content:null==r[e]||r[e].isDedicated?t(e):(f(),r[e].content)},v.save=function(e,t,n){if(m("statemodule.save"),null!=e)return"object"==typeof e&&({key:e,content:t}=a(e)),null==t&&null==n?p(e):o(e,t,n,!1)},v.saveSilently=function(e,t,n){return m("statemodule.saveSilently"),"object"==typeof e&&({key:e,content:t}=a(e)),o(e,t,n,!0)},v.saveAll=e,v.saveRegularState=h,v.remove=function(e){m("statemodule.remove"),null!=r[e]&&(r[e].isVolatile?delete r[e]:r[e].isDedicated?(localStorage.removeItem(e),delete r[e]):(delete r[e],delete g[e],h()))},v.get=function(e){if(null!=r[e])return r[e].content},v.set=function(e,t){m("statemodule.set"),"object"==typeof e&&({key:e,content:t}=a(e)),n(e,t,!1)},v.setSilently=function(e,t){m("statemodule.setSilently"),"object"==typeof e&&({key:e,content:t}=a(e)),n(e,t,!0)},v.addOnChangeListener=function(e,t){m("statemodule.addOnChangeListener"),null==d[e]&&(d[e]=[]),d[e].push(t)},v.removeOnChangeListener=function(e,t){var n,o,i,a;if(m("statemodule.removeOnChangeListener"),null!=(n=d[e])){for(o=i=0,a=n.length;i<a;o=++i)if(n[o]===t)return m("candidate found at: "+o),n[o]=n[n.length-1],void n.pop();m("No candidate found for given function!")}},v.clearOnChangeListeners=function(e,t){m("statemodule.clearOnChangeListener"),d[e]=[]},v.callOutChange=function(e){return c(e)},v.setChangeDetectionFunction=function(e,t){null==t?delete i[e]:i[e]=t},f(),b.exports=v}.call(this)}},o={};function et(e){var t=o[e];return void 0!==t||(t=o[e]={exports:{}},n[e].call(t.exports,t,t.exports,et)),t.exports}et.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return et.d(t,{a:t}),t},et.d=(e,t)=>{for(var n in t)et.o(t,n)&&!et.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},et.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),et.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),et.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={},t=(et.r(e),et.d(e,{reconnectTimeoutMS:()=>A,websocketURL:()=>J}),{}),n=(et.r(t),et.d(t,{connect:()=>Q,disconnect:()=>X,getUUID:()=>D,initialize:()=>H,sendMessage:()=>U}),{}),o=(et.r(n),et.d(n,{breakAllConnections:()=>ue,handleSDP:()=>se,initialize:()=>Z,initiateConnection:()=>S}),{}),i=(et.r(o),et.d(o,{addChatMessage:()=>He,displayPeers:()=>Ae,initialize:()=>Oe,showHangupButton:()=>$e}),{}),a=(et.r(i),et.d(i,{modulesToDebug:()=>_e}),{}),r=(et.r(a),et.d(a,{initialize:()=>Ye}),{});et.r(r),et.d(r,{initialize:()=>Qe});function c(t){var n;return{log:n=function(e){z[t]&&console.log("["+t+"]: "+e)},olog:function(e){return n("\n"+V(e))}}}var l,s,N,u,d,f,p,h,g,v,P,m,y,w,b,k={},V=(et.r(k),et.d(k,{initialize:()=>Xe}),function(e){return JSON.stringify(e,null,4)}),z={},J="wss://signalling-star.advice.land",A=200,C=et(981),H=({log:u,olog:d}=c("websocketmodule"),s=!(f=!1),function(){u("initialize"),l=C.load("UUID"),d({UUID:l}),l=l||crypto.randomUUID(),C.save({UUID:l})}),$=function(e){u("websocketCaughtError"),d(e),u(e.reason)},_=function(e){s||f||(f=!0,setTimeout(G,A))},F=function(e){u("websocketConnected"),null!=g&&(g(),g=null),U("setuuid "+l)},W=function(e){var t,n,o;switch(u("websocketMessageReceived"),u(e.data),(o=e.data.indexOf(" "))<0?n=e.data.trim():(n=e.data.substring(0,o),t=e.data.substring(o).trim()),n){case"alluids":q(t);break;case"chat":Y(t);break;case"sdp":se(t);break;default:u("unknown key "+n)}},q=function(e){u("applyAllUUIDS"),N=e.split(","),Ae(N)},Y=function(e){u("handleChat"),u(e),He(e)},G=function(){f=!1,K()},K=function(){u("createSocket"),"undefined"!=typeof webSocketReady&&null!==webSocketReady||(h=new Promise(function(e,t){return g=e})),(p=new WebSocket(J)).onerror=$,p.onclose=_,p.onopen=F,p.onmessage=W},U=async function(e){u("sendMessage "+e),s||(await h,p.send(e))},Q=function(){s=!1,K()},X=function(){null!==p&&(s=!0,p.close(),p=null)},D=function(){return l},Z=({log:v,olog:P}=c("webrtcmodule"),b={},w={},m=y=l=g=h=p=null,function(){v("initialize")}),ee=async function(e){var t,n,o,i,a,r,c,l,s,u;v("initiateConnectionForVideo"),o=I(),(b[e]=o).adviceLandType="outConnection",o.adviceLandUUID=e,i={audio:!(webCamBlock.src="")};try{for(u=(y=null==y?await navigator.mediaDevices.getUserMedia(i):y).getTracks(),r=0,c=u.length;r<c;r++)s=u[r],o.addTrack(s,y);l=await o.createOffer(),a=new RTCSessionDescription(l),await o.setLocalDescription(a),t={type:"audio-offer",sourceUUID:D(),targetUUID:e,offerObj:l},n=JSON.stringify(t),U(`sdp ${e} `+n)}catch(e){v(e)}},te=async function(e){var t,n,o,i,a,r,c,l,s,u;v("initiateConnectionForVideo"),o=I(),(b[e]=o).adviceLandType="outConnection",o.adviceLandUUID=e,i={video:!0,audio:!0};try{for(null==y&&(y=await navigator.mediaDevices.getUserMedia(i),webCamBlock.srcObject=y),u=y.getTracks(),r=0,c=u.length;r<c;r++)s=u[r],o.addTrack(s,y);l=await o.createOffer(),a=new RTCSessionDescription(l),await o.setLocalDescription(a),t={type:"video-offer",sourceUUID:D(),targetUUID:e,offerObj:l},n=JSON.stringify(t),U(`sdp ${e} `+n)}catch(e){v(e)}},I=function(){var e;return v("createRTCPeerConnection"),(e=new RTCPeerConnection({iceServers:[{urls:"turn:stun.advice.land",username:"usr",credential:"cred"}]})).onicecandidate=ne,e.ontrack=oe,e.onnegotiationneeded=ie,e.onremovetrack=ae,e.oniceconnectionstatechange=re,e.onicegatheringstatechange=ce,e.onsignalingstatechange=le,e},ne=function(e){var t,n;v("handleICECandidateEvent"),P(e.candidate),v(e.target.adviceLandType),v(e.target.adviceLandUUID),null!=e.candidate&&(t=e.candidate,n=e.target.adviceLandType,e=e.target.adviceLandUUID,t={type:"ice-candidate",candidate:t},"outConnection"===n?(t.sourceUUID=D(),t.targetUUID=e,t.youAreTarget=!0):"inConnection"===n&&(t.sourceUUID=e,t.targetUUID=D()),n=JSON.stringify(t),U(`sdp ${e} `+n))},oe=function(e){v("handleTrackEvent"),incomingVideoStreamsBlock.srcObject=event.streams[0]},ie=function(e){v("handleNegotiationNeededEvent")},ae=function(e){v("handleRemoveTrackEvent")},re=function(e){v("handleICEConnectionStateChangeEvent")},ce=function(e){v("handleICEGatheringStateChangeEvent")},le=function(e){v("handleSignalingStateChangeEvent")},se=async function(e){var t,n,o,i,a,r,c,l,s,u,d,f,p,h,g;v("handleSDP");try{if("video-offer"===(o=JSON.parse(e)).type){for(v("video-offer received"),r={video:!0,audio:!0},f=o.sourceUUID,a=I(),(w[f]=a).adviceLandType="inConnection",a.adviceLandUUID=f,c=new RTCSessionDescription(o.offerObj),await a.setRemoteDescription(c),null==y&&(y=await navigator.mediaDevices.getUserMedia(r),webCamBlock.srcObject=y),g=y.getTracks(),l=0,u=g.length;l<u;l++)h=g[l],a.addTrack(h,y);t=await a.createAnswer(),c=new RTCSessionDescription(t),await a.setLocalDescription(c),o={type:"video-answer",sourceUUID:o.sourceUUID,targetUUID:o.targetUUID,answerObj:t},i=JSON.stringify(o),U(`sdp ${f} `+i),$e()}if("call-offer"===o.type){for(v("call-offer received"),r={audio:!0},f=o.sourceUUID,a=I(),(w[f]=a).adviceLandType="inConnection",a.adviceLandUUID=f,c=new RTCSessionDescription(o.offerObj),await a.setRemoteDescription(c),g=(y=null==y?await navigator.mediaDevices.getUserMedia(r):y).getTracks(),s=0,d=g.length;s<d;s++)h=g[s],a.addTrack(h,y);t=await a.createAnswer(),c=new RTCSessionDescription(t),await a.setLocalDescription(c),o={type:"audio-answer",sourceUUID:o.sourceUUID,targetUUID:o.targetUUID,answerObj:t},i=JSON.stringify(o),U(`sdp ${f} `+i)}"video-answer"===o.type&&(v("video-answer received"),p=o.targetUUID,a=b[p],c=new RTCSessionDescription(o.answerObj),await a.setRemoteDescription(c),$e(),v(" - > connection should be configured!")),"audio-answer"===o.type&&(v("audio-answer received"),p=o.targetUUID,a=b[p],c=new RTCSessionDescription(o.answerObj),await a.setRemoteDescription(c),v(" - > connection should be configured!")),"ice-candidate"===o.type&&(v("ice-candidate received"),n=new RTCIceCandidate(o.candidate),await(a=o.youAreTarget?w[o.sourceUUID]:b[o.targetUUID]).addIceCandidate(n),v(" - > added ICE Candidate"))}catch(e){v(e)}},S=function(e,t){switch(v("initiateConnection"),t){case"call":ee(e);break;case"video":te(e)}},ue=function(){var e,t,n,o,i,a,r;for(r in v("breakCurrentConnection"),w)e=w[r],delete w[r],e.close();for(r in b)e=b[r],delete b[r],e.close();if(null!=y){for(t=0,o=(a=y.getTracks()).length;t<o;t++)a[t].stop();y=null}if(null!=m){for(n=0,i=(a=m.getTracks()).length;n<i;n++)a[n].stop();m=null}},de=Object.prototype.toString,B=Array.isArray||function(e){return"[object Array]"===de.call(e)};function T(e){return"function"==typeof e}function fe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function pe(e,t){return null!=e&&"object"==typeof e&&t in e}var he=RegExp.prototype.test,ge=/\S/,ve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},me=/\s*/,ye=/\s+/,we=/\s*=/,be=/\s*\}/,ke=/#|\^|\/|>|\{|&|=|!/;function R(e){this.string=e,this.tail=e,this.pos=0}function E(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function O(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}R.prototype.eos=function(){return""===this.tail},R.prototype.scan=function(e){var e=this.tail.match(e);return e&&0===e.index?(e=e[0],this.tail=this.tail.substring(e.length),this.pos+=e.length,e):""},R.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},E.prototype.push=function(e){return new E(e,this)},E.prototype.lookup=function(e){var t,n,o,i=this.cache;if(i.hasOwnProperty(e))t=i[e];else{for(var a,r,c,l=this,s=!1;l;){if(0<e.indexOf("."))for(a=l.view,r=e.split("."),c=0;null!=a&&c<r.length;)c===r.length-1&&(s=pe(a,r[c])||(n=a,o=r[c],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(o))),a=a[r[c++]];else a=l.view[e],s=pe(l.view,e);if(s){t=a;break}l=l.parent}i[e]=t}return t=T(t)?t.call(this.view):t},O.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},O.prototype.parse=function(e,j){var t=this.templateCache,n=e+":"+(j||x.tags).join(":"),o=void 0!==t,i=o?t.get(n):void 0;return null==i&&(i=function(e){if(!e)return[];var t,n,o,i,a=!1,r=[],c=[],l=[],s=!1,u=!1,d="",f=0;function p(){if(s&&!u)for(;l.length;)delete c[l.pop()];else l=[];u=s=!1}function h(e){if("string"==typeof e&&(e=e.split(ye,2)),!B(e)||2!==e.length)throw new Error("Invalid tags: "+e);t=new RegExp(fe(e[0])+"\\s*"),n=new RegExp("\\s*"+fe(e[1])),o=new RegExp("\\s*"+fe("}"+e[1]))}h(j||x.tags);for(var g,v,m,y,w,b,k=new R(e);!k.eos();){if(g=k.pos,m=k.scanUntil(t))for(var C=0,U=m.length;C<U;++C)i=y=m.charAt(C),he.call(ge,i)?(a=u=!0,d+=" "):(l.push(c.length),d+=y),c.push(["text",y,g,g+1]),g+=1,"\n"===y&&(p(),d="",f=0,a=!1);if(!k.scan(t))break;if(s=!0,v=k.scan(ke)||"name",k.scan(me),"="===v?(m=k.scanUntil(we),k.scan(we),k.scanUntil(n)):"{"===v?(m=k.scanUntil(o),k.scan(be),k.scanUntil(n),v="&"):m=k.scanUntil(n),!k.scan(n))throw new Error("Unclosed tag at "+k.pos);if(w=">"==v?[v,m,g,k.pos,d,f,a]:[v,m,g,k.pos],f++,c.push(w),"#"===v||"^"===v)r.push(w);else if("/"===v){if(!(b=r.pop()))throw new Error('Unopened section "'+m+'" at '+g);if(b[1]!==m)throw new Error('Unclosed section "'+b[1]+'" at '+g)}else"name"===v||"{"===v||"&"===v?u=!0:"="===v&&h(m)}if(p(),b=r.pop())throw new Error('Unclosed section "'+b[1]+'" at '+k.pos);for(var D,I=function(e){for(var t,n,o=[],i=0,a=e.length;i<a;++i)(t=e[i])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(o.push(t),n=t));return o}(c),S=[],T=S,E=[],O=0,L=I.length;O<L;++O)switch((D=I[O])[0]){case"#":case"^":T.push(D),E.push(D),T=D[4]=[];break;case"/":E.pop()[5]=D[2],T=0<E.length?E[E.length-1][4]:S;break;default:T.push(D)}return S}(e),o&&t.set(n,i)),i},O.prototype.render=function(e,t,n,o){var i=this.getConfigTags(o),i=this.parse(e,i),t=t instanceof E?t:new E(t,void 0);return this.renderTokens(i,t,n,e,o)},O.prototype.renderTokens=function(e,t,n,o,i){for(var a,r,c,l="",s=0,u=e.length;s<u;++s)c=void 0,"#"===(r=(a=e[s])[0])?c=this.renderSection(a,t,n,o,i):"^"===r?c=this.renderInverted(a,t,n,o,i):">"===r?c=this.renderPartial(a,t,n,i):"&"===r?c=this.unescapedValue(a,t):"name"===r?c=this.escapedValue(a,t,i):"text"===r&&(c=this.rawValue(a)),void 0!==c&&(l+=c);return l},O.prototype.renderSection=function(e,t,n,o,i){var a=this,r="",c=t.lookup(e[1]);if(c){if(B(c))for(var l=0,s=c.length;l<s;++l)r+=this.renderTokens(e[4],t.push(c[l]),n,o,i);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)r+=this.renderTokens(e[4],t.push(c),n,o,i);else if(T(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,o.slice(e[3],e[5]),function(e){return a.render(e,t,n,i)}))&&(r+=c)}else r+=this.renderTokens(e[4],t,n,o,i);return r}},O.prototype.renderInverted=function(e,t,n,o,i){var a=t.lookup(e[1]);if(!a||B(a)&&0===a.length)return this.renderTokens(e[4],t,n,o,i)},O.prototype.indentPartial=function(e,t,n){for(var o=t.replace(/[^ \t]/g,""),i=e.split("\n"),a=0;a<i.length;a++)i[a].length&&(0<a||!n)&&(i[a]=o+i[a]);return i.join("\n")},O.prototype.renderPartial=function(e,t,n,o){if(n){var i,a,r,c=this.getConfigTags(o),l=T(n)?n(e[1]):n[e[1]];if(null!=l)return i=e[6],r=e[5],e=e[4],a=l,0==r&&e&&(a=this.indentPartial(l,e,i)),r=this.parse(a,c),this.renderTokens(r,t,n,a,o)}},O.prototype.unescapedValue=function(e,t){t=t.lookup(e[1]);if(null!=t)return t},O.prototype.escapedValue=function(e,t,n){n=this.getConfigEscape(n)||x.escape,t=t.lookup(e[1]);if(null!=t)return("number"==typeof t&&n===x.escape?String:n)(t)},O.prototype.rawValue=function(e){return e[1]},O.prototype.getConfigTags=function(e){return B(e)?e:e&&"object"==typeof e?e.tags:void 0},O.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!B(e)?e.escape:void 0};var L,Ce,x={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){j.templateCache=e},get templateCache(){return j.templateCache}},j=new O;x.clearCache=function(){return j.clearCache()},x.parse=function(e,t){return j.parse(e,t)},x.render=function(e,t,n,o){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(B(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return j.render(e,t,n,o)},x.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return ve[e]})},x.Scanner=R,x.Context=E,x.Writer=O;const Ue=x;({log:L,olog:Ce}=c("chatframemodule"));var De,Ie,Se,Te=null,Ee=null,M=[],Oe=function(){L("initialize"),Le(),window.onhashchange=Le,chatInput.addEventListener("keydown",je),chatInput.addEventListener("blur",Be),hangupButton.addEventListener("click",Re),Te=peerDisplayTemplate.innerHTML,L(Te),Ee=chatElementTemplate.innerHTML,L(Ee)},Le=function(){L("locationHashChanged"),("#chat"===location.hash?Me:Ne)()},je=function(e){13===e.keyCode&&chatInput.value&&(xe(),chatInput.value="")},Be=function(e){chatInput.value&&(xe(),chatInput.value="")},Re=function(){L("hangupClicked"),ue(),hangupButton.classList.remove("here")},xe=function(){var e=chatInput.value;U("to all "+e)},Me=function(){L("pullChatIn"),document.body.style.height="100%",document.body.style.overflowY="hidden",chatframe.classList.add("here"),Q()},Ne=function(){L("pushChatOut"),document.body.style.height="auto",document.body.style.overflowY="scroll",chatframe.classList.remove("here"),X(),chatHistoryBlock.innerHTML="",peerDisplayBlock.innerHTML="",M=[]},Pe=function(e){for(var t=0;!e.classList.contains("peer-display-element");)if(e=e.parentNode,3<++t)throw new Error("No nearby parent having class peer-display-element");return e.getAttribute("uuid")},Ve=function(e){L("peerCallClicked"),e=Pe(e.target),L(e),S(e,"call")},ze=function(e){L("peerVideoClicked"),e=Pe(e.target),L(e),S(e,"video")},Je=function(){for(var e,t="",n=0,o=M.length;n<o;n++)e=M[n],t+=Ue.render(Ee,e);chatHistoryBlock.innerHTML=t},Ae=function(e){for(var t,n,o,i,a,r,c,l,s="",u=0,d=e.length;u<d;u++)t={uuid:e[u]},s+=Ue.render(Te,t);for(peerDisplayBlock.innerHTML=s,null!=(c=peerDisplayBlock.querySelector(`[uuid='${D()}']`))&&c.classList.add("self"),o=0,a=(n=peerDisplayBlock.getElementsByClassName("peer-call-button")).length;o<a;o++)n[o].addEventListener("click",Ve);for(i=0,r=(l=peerDisplayBlock.getElementsByClassName("peer-video-button")).length;i<r;i++)l[i].addEventListener("click",ze)},He=function(e){var t,n;L(e),t=""+(n=new Date).getHours(),n=""+n.getMinutes(),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),M.unshift({text:e,time:t+":"+n}),64<M.length&&(M.length=64),L(M.length),Je()},$e=function(){hangupButton.classList.add("here")},_e={unbreaker:!0,webrtcmodule:!0},Fe=_e;for(Se in Fe)Fe[Se]&&(z[Se]=!0);({log:De,olog:Ie}=c("footermodule"));var We,qe,Ye=function(){De("initialize")};({log:We,olog:qe}=c("headermodule"));var Ge,Ke,Qe=function(){We("initialize")},Xe=({log:Ge,olog:Ke}=c("onsitechatmodule"),function(){Ge("initialize")});const Ze={chatframemodule:o,configmodule:e,debugmodule:i,footermodule:a,headermodule:r,onsitechatmodule:k,statemodule:C,webrtcmodule:n,websocketmodule:t};o=et(62);et.n(o)().initialize(),et.g.allModules=Ze,async function(){var t,n,e=function(){var e=[];for(n in Ze)null!=(t=Ze[n]).initialize&&e.push(t.initialize());return e}();await Promise.all(e)}()})()})()</script></body></html>